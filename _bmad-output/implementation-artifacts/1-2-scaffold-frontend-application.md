# Story 1.2: Scaffold Frontend Application

Status: review

<!-- Ultimate Context Engine Analysis: 2026-02-09 -->
<!-- Previous story: 1-1-initialize-monorepo-structure (done) -->

## Story

As a **developer**,
I want a **React + Vite + TypeScript frontend with shadcn/ui configured**,
So that I can **build the user interface with modern tooling and accessible components**.

## Acceptance Criteria

1. **AC1:** React 19+ with Vite is installed in `apps/frontend/`
2. **AC2:** TypeScript strict mode is enabled
3. **AC3:** Tailwind CSS v4 is configured with the project's design tokens
4. **AC4:** shadcn/ui is initialized with Button, Card, and Input components
5. **AC5:** React Router v7 is configured with placeholder routes (`/`, `/login`)
6. **AC6:** TanStack Query v5 is installed and configured with `QueryClientProvider`
7. **AC7:** The app runs on `localhost:5173` with HMR working
8. **AC8:** Biome is configured at monorepo root for linting and formatting consistency across all workspaces

## Tasks / Subtasks

- [x] **Task 1: Scaffold React + Vite + TypeScript** (AC: 1, 2, 7)
  - [x] 1.1 Run `npm create vite@latest` with `react-ts` template in `apps/frontend/` (replace existing placeholder)
  - [x] 1.2 Preserve `@battlecrm/frontend` package name and `"private": true` in package.json
  - [x] 1.3 Enable TypeScript strict mode in `tsconfig.json` (`"strict": true`)
  - [x] 1.4 Configure Vite to use root `.env` via `envDir: '../../'`
  - [x] 1.5 Verify `pnpm dev` runs and serves on `localhost:5173` with HMR

- [x] **Task 2: Configure Tailwind CSS v4** (AC: 3)
  - [x] 2.1 Install Tailwind CSS v4 and `@tailwindcss/vite` plugin
  - [x] 2.2 Configure Vite plugin in `vite.config.ts` (Tailwind v4 uses Vite plugin, NOT PostCSS)
  - [x] 2.3 Create/update main CSS file with `@import "tailwindcss"` directive
  - [x] 2.4 Add semantic CSS custom properties for BattleCRM design tokens (see Design Tokens section)
  - [x] 2.5 Verify Tailwind utilities work in a test component

- [x] **Task 3: Initialize shadcn/ui** (AC: 4)
  - [x] 3.1 Run `npx shadcn@latest init` and configure for light mode, default style
  - [x] 3.2 Add initial components: `npx shadcn@latest add button card input`
  - [x] 3.3 Verify components render correctly with Tailwind styling
  - [x] 3.4 Configure `components.json` with proper aliases matching project structure

- [x] **Task 4: Configure React Router v7** (AC: 5)
  - [x] 4.1 Install `react-router` (v7 - single package, no separate `react-router-dom`)
  - [x] 4.2 Create `src/routes.tsx` with `BrowserRouter` and placeholder routes
  - [x] 4.3 Create placeholder pages: `DashboardPage.tsx` (route `/`), `LoginPage.tsx` (route `/login`)
  - [x] 4.4 Place pages in `src/features/dashboard/` and `src/features/auth/` respectively

- [x] **Task 5: Configure TanStack Query** (AC: 6)
  - [x] 5.1 Install `@tanstack/react-query` and `@tanstack/react-query-devtools`
  - [x] 5.2 Create `QueryClient` in `App.tsx` with `QueryClientProvider` wrapping the router
  - [x] 5.3 Enable DevTools in development mode only
  - [x] 5.4 Create `src/lib/queryKeys.ts` with initial empty query key factory

- [x] **Task 6: Configure Biome at Monorepo Root** (AC: 8)
  - [x] 6.1 Install `@biomejs/biome` as root devDependency: `pnpm add -D -w @biomejs/biome`
  - [x] 6.2 Initialize config at monorepo root: `pnpm biome init` (creates `biome.json`)
  - [x] 6.3 Configure `biome.json` with project rules (see Biome Config section below)
  - [x] 6.4 Add root `package.json` scripts: `"lint": "biome check ."`, `"format": "biome check --write ."`, `"lint:fix": "biome check --write --unsafe ."`
  - [x] 6.5 Update `apps/frontend/package.json` scripts: `"lint"` and `"format"` delegate to root Biome
  - [x] 6.6 Remove any ESLint/Prettier files generated by Vite scaffold (`eslint.config.js`, etc.)
  - [x] 6.7 Verify `pnpm lint` from root checks all workspaces
  - [x] 6.8 Verify `pnpm format` from root formats all workspaces

- [x] **Task 7: Clean Up and Structure** (AC: 1-8)
  - [x] 7.1 Remove Vite boilerplate (default App.tsx content, logo, demo CSS)
  - [x] 7.2 Create feature-based folder structure: `src/features/`, `src/components/ui/`, `src/lib/`, `src/hooks/`, `src/schemas/`, `src/types/`
  - [x] 7.3 Create `src/App.tsx` with QueryClientProvider + BrowserRouter + Routes
  - [x] 7.4 Verify `pnpm dev` from monorepo root starts frontend on port 5173

- [x] **Task 8: Verification** (AC: 1-8)
  - [x] 8.1 `pnpm dev` starts with HMR working (change text, see update)
  - [x] 8.2 TypeScript strict mode catches type errors
  - [x] 8.3 Tailwind utilities render correctly
  - [x] 8.4 shadcn/ui components render (Button, Card, Input)
  - [x] 8.5 React Router navigates between `/` and `/login`
  - [x] 8.6 TanStack Query DevTools visible in dev mode
  - [x] 8.7 `pnpm lint` passes on all source files (Biome from root)
  - [x] 8.8 `pnpm build` produces optimized production bundle

## Dev Notes

### Critical Architecture Requirements

**MUST USE these exact technologies - NO substitutions:**

| Technology | Version | Notes |
|-----------|---------|-------|
| React | 19.x | Latest stable (NOT React 18) |
| Vite | Latest (7.x) | With `react-ts` template |
| TypeScript | Strict mode | Latest stable |
| Tailwind CSS | **v4** | CSS-first config, Vite plugin (NOT PostCSS + tailwind.config.js) |
| shadcn/ui | Latest | `npx shadcn@latest init` |
| React Router | v7 | Single `react-router` package |
| TanStack Query | v5 | `@tanstack/react-query` |
| Biome | v2.x | **Monorepo root config** - replaces ESLint + Prettier with single tool |

### CRITICAL: Tailwind CSS v4 Changes

Tailwind CSS v4 is a **major breaking change** from v3. Do NOT follow v3 patterns:

| v3 (OLD - DO NOT USE) | v4 (CORRECT) |
|------------------------|--------------|
| `tailwind.config.js` | CSS-first config via `@theme` in CSS |
| `postcss.config.js` with `tailwindcss` plugin | `@tailwindcss/vite` Vite plugin |
| `@tailwind base; @tailwind components; @tailwind utilities;` | `@import "tailwindcss";` |
| `content: ['./src/**/*.{ts,tsx}']` in config | Automatic content detection |
| `theme.extend.colors` in JS config | `@theme { --color-*: ... }` in CSS |

**Tailwind v4 Installation (Vite):**
```bash
pnpm add tailwindcss @tailwindcss/vite
```

**vite.config.ts:**
```typescript
import tailwindcss from '@tailwindcss/vite'
import react from '@vitejs/plugin-react'
import { defineConfig } from 'vite'

export default defineConfig({
  plugins: [react(), tailwindcss()],
  envDir: '../../',
})
```

**Main CSS file:**
```css
@import "tailwindcss";
```

### CRITICAL: Biome Replaces ESLint + Prettier (Monorepo-Wide)

**Do NOT install ESLint, Prettier, or any of their plugins.** Biome handles linting AND formatting in a single tool, configured once at the monorepo root.

- Biome is installed as a **root devDependency** (NOT per workspace)
- Single `biome.json` at monorepo root applies to all workspaces (frontend, backend, shared)
- Story 1.3 (backend) will reuse this same config - no Adonis ESLint/Prettier packages needed
- Delete any ESLint/Prettier files generated by Vite scaffold

**Installation (from monorepo root):**
```bash
pnpm add -D -w @biomejs/biome
pnpm biome init
```

**biome.json (monorepo root):**
```json
{
  "$schema": "https://biomejs.dev/schemas/latest/schema.json",
  "vcs": {
    "enabled": true,
    "clientKind": "git",
    "useIgnoreFile": true
  },
  "organizeImports": {
    "enabled": true
  },
  "formatter": {
    "indentStyle": "space",
    "indentWidth": 2,
    "lineWidth": 100
  },
  "linter": {
    "enabled": true,
    "rules": {
      "recommended": true
    }
  },
  "javascript": {
    "formatter": {
      "quoteStyle": "single",
      "semicolons": "asNeeded"
    }
  },
  "files": {
    "ignore": [
      "dist/",
      "node_modules/",
      ".pnpm-store/",
      "_bmad/",
      "_bmad-output/",
      "pnpm-lock.yaml"
    ]
  }
}
```

**Root package.json scripts:**
```json
{
  "scripts": {
    "lint": "biome check .",
    "format": "biome check --write .",
    "lint:fix": "biome check --write --unsafe ."
  }
}
```

**Per-workspace package.json scripts (apps/frontend, apps/backend):**
```json
{
  "scripts": {
    "lint": "biome check .",
    "format": "biome check --write ."
  }
}
```

**React hooks rules:** Biome includes `useHookAtTopLevel` (rules-of-hooks) and `useExhaustiveDependencies` (exhaustive-deps) natively - no plugins needed.

**Impact on Story 1.3 (backend):** When scaffolding Adonis.js, do NOT install `@adonisjs/eslint-config` or `@adonisjs/prettier-config`. The root Biome config will handle the backend too.

### CRITICAL: React Router v7

React Router v7 is a single package - do NOT install `react-router-dom` separately.

```bash
pnpm add react-router
```

```typescript
import { BrowserRouter, Routes, Route } from 'react-router'
```

### IMPORTANT: VineJS Frontend Limitation

The architecture document specifies VineJS for frontend validation. **VineJS is Node.js only and CANNOT run in the browser.** This story does NOT set up frontend validation - that will be addressed in a later story. For now, just create the `src/schemas/` directory as a placeholder.

### Design Tokens (from UX Specification)

**Semantic Colors to configure via CSS custom properties:**

```css
@import "tailwindcss";

@theme {
  /* Semantic colors for BattleCRM */
  --color-success: oklch(0.723 0.219 149.579); /* green-500 */
  --color-warning: oklch(0.769 0.188 70.08);   /* amber-500 */
  --color-danger: oklch(0.637 0.237 25.331);    /* red-500 */
}
```

**Typography:** Use shadcn/Inter font stack (system-ui fallback). Tailwind v4 defaults.

**Spacing:** Tailwind default scale. Hybrid density approach (dense for lists, airy for forms).

**Light mode only** - no dark mode toggle needed.

### Project Structure to Create

**Monorepo root (new files):**
```
BattleCRM/
├── biome.json               # NEW - Linting + formatting for ALL workspaces
└── package.json             # MODIFY - Add lint/format scripts
```

**Frontend workspace:**
```
apps/frontend/
├── src/
│   ├── components/
│   │   ├── ui/              # shadcn/ui components (auto-generated)
│   │   └── common/          # Shared custom components (empty for now)
│   ├── features/
│   │   ├── auth/
│   │   │   └── LoginPage.tsx       # Placeholder login page
│   │   └── dashboard/
│   │       └── DashboardPage.tsx   # Placeholder dashboard page
│   ├── hooks/               # Shared hooks (empty for now)
│   ├── lib/
│   │   ├── queryKeys.ts     # Centralized TanStack Query keys
│   │   └── utils.ts         # shadcn/ui cn() utility
│   ├── schemas/             # VineJS schemas placeholder (empty)
│   ├── types/               # Shared TypeScript types (empty)
│   ├── App.tsx              # Root: QueryClientProvider + Router
│   ├── main.tsx             # Entry point
│   ├── index.css            # Tailwind v4 import + design tokens
│   └── routes.tsx           # Route definitions
├── index.html
├── package.json             # @battlecrm/frontend
├── tsconfig.json            # Strict mode
├── tsconfig.app.json
├── tsconfig.node.json
├── vite.config.ts           # React + Tailwind v4 plugins, envDir
└── components.json          # shadcn/ui config
# NOTE: No eslint.config.js or .prettierrc here - Biome config is at monorepo root
```

### Naming Conventions (CRITICAL)

| Element | Convention | Example |
|---------|------------|---------|
| Component files | PascalCase | `DashboardPage.tsx`, `LoginPage.tsx` |
| Page components | PascalCase + `Page` suffix | `DashboardPage.tsx` |
| Utils/hooks files | camelCase | `queryKeys.ts`, `utils.ts` |
| Component exports | PascalCase named exports | `export function DashboardPage()` |
| Functions/variables | camelCase | `queryKeys`, `createQueryClient` |
| Types | PascalCase + `Type` suffix | `ProspectType`, `BattleType` |
| Constants | SCREAMING_SNAKE | `MAX_FUNNEL_STAGES` |

### Previous Story Intelligence (Story 1.1)

**What was created:**
- pnpm workspace with `apps/*` and `packages/*`
- Root `package.json` (name: `battlecrm`, pnpm@9.15.0, engines node>=20.6.0, pnpm>=9.0.0)
- Root `.env` and `.env.example` with all placeholder variables
- `apps/frontend/package.json` - placeholder with `@battlecrm/frontend` name
- `apps/backend/package.json` - placeholder with `@battlecrm/backend` name
- `packages/shared/` with `src/index.ts` (empty export)

**Learnings from Review:**
- Use `workspace:*` for internal package links
- Shared package exists but is optional - don't import from it yet
- The root `.env` has `VITE_API_URL=http://localhost:3333/api` and `VITE_APP_URL=http://localhost:5173`
- pnpm v9.15.0 is the installed version

**Files NOT to modify:**
- `pnpm-workspace.yaml` - already configured
- `packages/shared/` - leave as-is
- `apps/backend/` - leave as-is (Story 1.3)
- Root `.env` and `.env.example` - already have frontend vars
- `_bmad/` and `_bmad-output/` - BMAD directories, never touch

### Git Intelligence

**Last commit:** `2f2d1a4 feat(story 1.1): initialize project monorepo structure`

**Commit convention:** `feat(story X.Y): description` format

### Environment Variables Available (from root .env)

The following `VITE_*` variables are already defined in root `.env`:
- `VITE_API_URL=http://localhost:3333/api`
- `VITE_APP_URL=http://localhost:5173`

Access via `import.meta.env.VITE_API_URL` in frontend code.
Configure Vite with `envDir: '../../'` to read from monorepo root.

### Anti-Patterns to AVOID

- **DO NOT** use `tailwind.config.js` - Tailwind v4 uses CSS-first configuration
- **DO NOT** install ESLint, Prettier, or their plugins - Biome replaces them all
- **DO NOT** create `eslint.config.js`, `.eslintrc.*`, or `.prettierrc` in `apps/frontend/` - Biome config lives at monorepo root
- **DO NOT** install `@adonisjs/eslint-config` or `@adonisjs/prettier-config` (relevant for Story 1.3)
- **DO NOT** install `react-router-dom` separately - React Router v7 is a single package
- **DO NOT** use Zod for validation - architecture specifies VineJS (but skip frontend validation for now)
- **DO NOT** use JWT/access tokens patterns - architecture uses sessions with httpOnly cookies
- **DO NOT** create a dark mode toggle - light mode only per UX spec
- **DO NOT** use CSS Modules or styled-components - Tailwind CSS only
- **DO NOT** install Turborepo - pnpm workspaces native only
- **DO NOT** add dependencies to `packages/shared` or import from it

### Project Structure Notes

**Alignment with Architecture:**
- Feature-based organization exactly matches Architecture Document structure patterns
- `src/components/ui/` for shadcn, `src/features/` for feature modules
- `src/lib/queryKeys.ts` as specified in Architecture for centralized query keys
- Page components suffixed with `Page` as per naming conventions

**Dependency on Story 1.1:**
- Monorepo structure exists and is verified working
- Root `.env` with frontend variables exists
- pnpm workspace configuration recognizes `apps/frontend`

### References

- [Source: _bmad-output/planning-artifacts/architecture.md#Frontend Architecture]
- [Source: _bmad-output/planning-artifacts/architecture.md#Implementation Patterns & Consistency Rules]
- [Source: _bmad-output/planning-artifacts/architecture.md#Project Structure & Boundaries]
- [Source: _bmad-output/planning-artifacts/architecture.md#Initialization Commands]
- [Source: _bmad-output/planning-artifacts/ux-design-specification.md#Visual Design Foundation]
- [Source: _bmad-output/planning-artifacts/ux-design-specification.md#Design System Foundation]
- [Source: _bmad-output/planning-artifacts/epics.md#Story 1.2]
- [Source: _bmad-output/project-context.md#Technology Stack]
- [Source: _bmad-output/implementation-artifacts/1-1-initialize-monorepo-structure.md]

---

## Dev Agent Record

### Agent Model Used

Claude Opus 4.6 (claude-opus-4-6)

### Debug Log References

- Biome v2 config schema changed from v1: `organizeImports` moved to `assist.actions.source.organizeImports`, `files.ignore` replaced by `files.includes` pattern, CSS Tailwind directives need `css.parser.tailwindDirectives: true`
- shadcn/ui `init` requires path aliases in both `tsconfig.json` and `tsconfig.app.json`
- `noNonNullAssertion` rule disabled in Biome config as Vite's `main.tsx` uses `document.getElementById('root')!` pattern

### Completion Notes List

- Scaffolded React 19.2 + Vite 7.3 + TypeScript strict mode frontend
- Configured Tailwind CSS v4 with Vite plugin and BattleCRM design tokens (success, warning, danger colors)
- Initialized shadcn/ui with new-york style, slate base color, and added Button, Card, Input components
- Configured React Router v7 with BrowserRouter, placeholder routes for `/` (DashboardPage) and `/login` (LoginPage)
- Set up TanStack Query v5 with QueryClientProvider and DevTools in App.tsx
- Created centralized query key factory in `src/lib/queryKeys.ts`
- Configured Biome v2.3 at monorepo root with single-quote, no-semicolons, 2-space indent, 100-char line width, Tailwind CSS support
- Created feature-based folder structure: features/, components/ui/, components/common/, lib/, hooks/, schemas/, types/
- Removed all Vite boilerplate (demo App, CSS, SVGs)
- All lint checks pass, TypeScript type-check passes, production build succeeds

### Change Log

| Date | Change | Author |
|------|--------|--------|
| 2026-02-09 | Story created with ultimate context analysis | SM Agent (Opus 4.6) |
| 2026-02-09 | Replaced ESLint+Prettier with Biome at monorepo root (user decision) | SM Agent (Opus 4.6) |
| 2026-02-10 | Implemented all 8 tasks: Vite+React scaffold, Tailwind v4, shadcn/ui, React Router v7, TanStack Query, Biome, cleanup, verification | Dev Agent (Opus 4.6) |

### File List

**New files:**
- `biome.json` - Biome v2 config at monorepo root (lint + format for all workspaces)
- `apps/frontend/components.json` - shadcn/ui configuration
- `apps/frontend/src/App.tsx` - Root component with QueryClientProvider + Router
- `apps/frontend/src/routes.tsx` - BrowserRouter with route definitions
- `apps/frontend/src/index.css` - Tailwind v4 import + shadcn/ui theme + BattleCRM design tokens
- `apps/frontend/src/main.tsx` - Entry point (Vite scaffold, preserved)
- `apps/frontend/src/lib/utils.ts` - shadcn/ui cn() utility
- `apps/frontend/src/lib/queryKeys.ts` - Centralized TanStack Query key factory
- `apps/frontend/src/components/ui/button.tsx` - shadcn/ui Button component
- `apps/frontend/src/components/ui/card.tsx` - shadcn/ui Card component
- `apps/frontend/src/components/ui/input.tsx` - shadcn/ui Input component
- `apps/frontend/src/features/dashboard/DashboardPage.tsx` - Placeholder dashboard page
- `apps/frontend/src/features/auth/LoginPage.tsx` - Placeholder login page
- `apps/frontend/src/components/common/` - Empty directory for shared components
- `apps/frontend/src/hooks/` - Empty directory for shared hooks
- `apps/frontend/src/schemas/` - Empty directory for VineJS schemas (placeholder)
- `apps/frontend/src/types/` - Empty directory for shared TypeScript types

**Modified files:**
- `package.json` - Added Biome devDependency, updated lint/format scripts to use Biome directly
- `apps/frontend/package.json` - Added all dependencies (React 19, Tailwind v4, shadcn/ui deps, React Router v7, TanStack Query v5), updated lint/format scripts
- `apps/frontend/vite.config.ts` - Added Tailwind v4 plugin, path alias resolve, envDir
- `apps/frontend/tsconfig.json` - Added path aliases (@/*)
- `apps/frontend/tsconfig.app.json` - Added path aliases (@/*), strict mode confirmed
- `apps/frontend/index.html` - Updated title to BattleCRM, removed vite.svg favicon ref
- `pnpm-lock.yaml` - Updated with all new dependencies

**Deleted files:**
- `apps/frontend/src/App.css` - Vite boilerplate CSS
- `apps/frontend/src/assets/react.svg` - Vite boilerplate logo
- `apps/frontend/public/vite.svg` - Vite boilerplate favicon
